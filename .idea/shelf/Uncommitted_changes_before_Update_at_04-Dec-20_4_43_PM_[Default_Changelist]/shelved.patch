Index: app/src/main/java/com/masterandroid/backgroundservice/LocationService.java
IDEA additional info:
Subsystem: com.intellij.openapi.diff.impl.patch.BaseRevisionTextPatchEP
<+>package com.masterandroid.backgroundservice;\r\n\r\nimport android.Manifest;\r\nimport android.app.NotificationChannel;\r\nimport android.app.NotificationManager;\r\nimport android.app.PendingIntent;\r\nimport android.app.Service;\r\nimport android.content.Context;\r\nimport android.content.Intent;\r\nimport android.content.SharedPreferences;\r\nimport android.content.pm.PackageManager;\r\nimport android.location.Address;\r\nimport android.location.Geocoder;\r\nimport android.os.Build;\r\nimport android.os.CountDownTimer;\r\nimport android.os.IBinder;\r\nimport android.os.Looper;\r\nimport android.util.Log;\r\n\r\nimport androidx.annotation.Nullable;\r\nimport androidx.core.app.ActivityCompat;\r\nimport androidx.core.app.NotificationCompat;\r\n\r\nimport com.google.android.gms.location.LocationCallback;\r\nimport com.google.android.gms.location.LocationRequest;\r\nimport com.google.android.gms.location.LocationResult;\r\nimport com.google.android.gms.location.LocationServices;\r\nimport com.google.gson.Gson;\r\n\r\nimport java.io.IOException;\r\nimport java.util.ArrayList;\r\nimport java.util.List;\r\nimport java.util.Locale;\r\n\r\npublic class LocationService extends Service {\r\n\r\n    String details;\r\n    List<String> visitAddress;\r\n\r\n    static CountDownTimer countDownTimer = null;\r\n    private LocationCallback locationCallback = new LocationCallback() {\r\n        @Override\r\n        public void onLocationResult(LocationResult locationResult) {\r\n            super.onLocationResult(locationResult);\r\n            if (locationResult != null && locationResult.getLastLocation() != null) {\r\n                double longitude = locationResult.getLastLocation().getLongitude();\r\n                double latitude = locationResult.getLastLocation().getLatitude();\r\n                Log.d (\"LOCATION_UPDATE\",latitude+\",\"+longitude);\r\n                details= getAddress(longitude,latitude);\r\n                visitAddress.add(details);\r\n            }\r\n        }\r\n    };\r\n\r\n\r\n    @Nullable\r\n    @Override\r\n    public IBinder onBind(Intent intent) {\r\n        throw new UnsupportedOperationException(\"Not yet Implemented\");\r\n    }\r\n\r\n    private void startLocation()\r\n    {\r\n        if (countDownTimer != null) {\r\n            countDownTimer.cancel();\r\n        }\r\n        // 60*1*1000 = 1 min\r\n        // 50000 = 50 seconds\r\n        // 10000 = 10 seconds;\r\n        countDownTimer = new CountDownTimer(20000, 1000) {\r\n            public void onTick(long millisUntilFinished)\r\n            {\r\n                String channelId = \"location notification channel\";\r\n                NotificationManager notificationManager = (NotificationManager) getSystemService(Context.NOTIFICATION_SERVICE);\r\n                Intent resultIntent = new Intent();\r\n                PendingIntent pendingIntent = PendingIntent.getActivity(\r\n                        getApplicationContext(), 0,\r\n                        resultIntent,\r\n                        PendingIntent.FLAG_UPDATE_CURRENT);\r\n                NotificationCompat.Builder builder = new NotificationCompat.Builder(\r\n                        getApplicationContext(),\r\n                        channelId\r\n                );\r\n\r\n                builder.setSmallIcon(R.mipmap.ic_launcher);\r\n                builder.setContentTitle(\"Location Service\");\r\n                builder.setDefaults(NotificationCompat.DEFAULT_ALL);\r\n                builder.setContentText(\"running\");\r\n                builder.setContentIntent(pendingIntent);\r\n                builder.setAutoCancel(false);\r\n                builder.setPriority(NotificationCompat.PRIORITY_MAX);\r\n\r\n                if (Build.VERSION.SDK_INT >= Build.VERSION_CODES.O) {\r\n                    if (notificationManager != null && notificationManager.getNotificationChannel(channelId) == null) {\r\n                        NotificationChannel notificationChannel = new NotificationChannel(\r\n                                channelId, \"Location Service\",\r\n                                NotificationManager.IMPORTANCE_HIGH\r\n                        );\r\n                        notificationChannel.setDescription(\"This channel is used by location service\");\r\n                        notificationManager.createNotificationChannel(notificationChannel);\r\n                    }\r\n                }\r\n                LocationRequest locationRequest = new LocationRequest();\r\n                locationRequest.setInterval(5000);\r\n                locationRequest.setFastestInterval(60*100);\r\n                locationRequest.setPriority(LocationRequest.PRIORITY_HIGH_ACCURACY);\r\n\r\n                if (ActivityCompat.checkSelfPermission(LocationService.this, Manifest.permission.ACCESS_FINE_LOCATION)\r\n                        != PackageManager.PERMISSION_GRANTED && ActivityCompat.checkSelfPermission(LocationService.this,\r\n                        Manifest.permission.ACCESS_COARSE_LOCATION) != PackageManager.PERMISSION_GRANTED) {\r\n                    // TODO: Consider calling\r\n                    //    ActivityCompat#requestPermissions\r\n                    // here to request the missing permissions, and then overriding\r\n                    //   public void onRequestPermissionsResult(int requestCode, String[] permissions,\r\n                    //                                          int[] grantResults)\r\n                    // to handle the case where the user grants the permission. See the documentation\r\n                    // for ActivityCompat#requestPermissions for more details.\r\n                    return;\r\n                }\r\n                LocationServices.getFusedLocationProviderClient(LocationService.this)\r\n                        .requestLocationUpdates(locationRequest, locationCallback, Looper.getMainLooper());\r\n                startForeground(Constants.LOCATION_SERVICE_ID,builder.build());\r\n\r\n            }\r\n            public void onFinish()\r\n            {\r\n                Log.d(\"done!\", \"done!\");\r\n                stopLocation();\r\n                Gson gson= new Gson();\r\n                String jsonText= gson.toJson(visitAddress);\r\n                SharedPreferences sharedPreferences= getSharedPreferences(\"Details\", Context.MODE_PRIVATE);\r\n                SharedPreferences.Editor editor= sharedPreferences.edit();\r\n                editor.putString(\"AddressList\",jsonText);\r\n                editor.apply();\r\n\r\n\r\n            }\r\n        };\r\n        countDownTimer.start();\r\n        visitAddress= new ArrayList<>();\r\n\r\n\r\n\r\n\r\n\r\n    }\r\n\r\n    private void stopLocation(){\r\n        LocationServices.getFusedLocationProviderClient(this)\r\n                .removeLocationUpdates(locationCallback);\r\n        stopForeground(true);\r\n        stopSelf();\r\n        countDownTimer.cancel();\r\n\r\n    }\r\n\r\n    private String getAddress(double Longitude, double Latitude){\r\n        Geocoder geocoder;\r\n        String completeDetails=\"\";\r\n        List<Address> addresses= new ArrayList<>();\r\n        geocoder=new Geocoder(this, Locale.getDefault());\r\n\r\n        try {\r\n            addresses= geocoder.getFromLocation(Latitude,Longitude,1);\r\n            String address = addresses.get(0).getAddressLine(0); // If any additional address line present than only, check with max available address lines by getMaxAddressLineIndex()\r\n            String city = addresses.get(0).getLocality();\r\n            String state = addresses.get(0).getAdminArea();\r\n            String country = addresses.get(0).getCountryName();\r\n            String postalCode = addresses.get(0).getPostalCode();\r\n            String knownName = addresses.get(0).getFeatureName();\r\n\r\n            completeDetails= address;\r\n            Log.d(\"LOCATION_DETAILS\",Latitude+\", \"+Longitude+\", \"+knownName+\", \"+address);\r\n        } catch (IOException e) {\r\n            e.printStackTrace();\r\n        }\r\n        return completeDetails;\r\n    }\r\n\r\n    @Override\r\n    public int onStartCommand(Intent intent, int flags, int startId) {\r\n        if(intent!=null){\r\n            String action= intent.getAction();\r\n            if(action!=null){\r\n                if(action.equals(Constants.ACTION_START_LOCATION_SERVICE)){\r\n                    startLocation();\r\n                }\r\n                else if(action.equals(Constants.ACTION_STOP_LOCATION_SERVICE)){\r\n                    stopLocation();\r\n                }\r\n            }\r\n        }\r\n        return super.onStartCommand(intent, flags, startId);\r\n    }\r\n}\r\n
Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
<+>UTF-8
===================================================================
--- app/src/main/java/com/masterandroid/backgroundservice/LocationService.java	(revision f4b97c3024a5a83433064f2a25999825a4b52b9f)
+++ app/src/main/java/com/masterandroid/backgroundservice/LocationService.java	(date 1607068257755)
@@ -35,7 +35,8 @@
 public class LocationService extends Service {
 
     String details;
-    List<String> visitAddress;
+    List<place> visitAddress;
+    place myPlace;
 
     static CountDownTimer countDownTimer = null;
     private LocationCallback locationCallback = new LocationCallback() {
@@ -47,7 +48,7 @@
                 double latitude = locationResult.getLastLocation().getLatitude();
                 Log.d ("LOCATION_UPDATE",latitude+","+longitude);
                 details= getAddress(longitude,latitude);
-                visitAddress.add(details);
+                visitAddress.add(myPlace);
             }
         }
     };
@@ -132,17 +133,10 @@
                 SharedPreferences.Editor editor= sharedPreferences.edit();
                 editor.putString("AddressList",jsonText);
                 editor.apply();
-
-
             }
         };
         countDownTimer.start();
         visitAddress= new ArrayList<>();
-
-
-
-
-
     }
 
     private void stopLocation(){
@@ -154,6 +148,10 @@
 
     }
 
+    private void addDetailsInDb(){
+
+    }
+
     private String getAddress(double Longitude, double Latitude){
         Geocoder geocoder;
         String completeDetails="";
@@ -169,7 +167,12 @@
             String postalCode = addresses.get(0).getPostalCode();
             String knownName = addresses.get(0).getFeatureName();
 
-            completeDetails= address;
+            myPlace= new place();
+            myPlace.setPlace_lat(Latitude);
+            myPlace.setPlace_lon(Latitude);
+            myPlace.setPlace_address(address);
+            myPlace.setCity(city);
+
             Log.d("LOCATION_DETAILS",Latitude+", "+Longitude+", "+knownName+", "+address);
         } catch (IOException e) {
             e.printStackTrace();
Index: app/src/main/java/com/masterandroid/backgroundservice/mainService.java
===================================================================
--- app/src/main/java/com/masterandroid/backgroundservice/mainService.java	(revision f4b97c3024a5a83433064f2a25999825a4b52b9f)
+++ app/src/main/java/com/masterandroid/backgroundservice/mainService.java	(revision f4b97c3024a5a83433064f2a25999825a4b52b9f)
@@ -1,63 +0,0 @@
-package com.masterandroid.backgroundservice;
-
-import android.app.Service;
-import android.content.Intent;
-import android.os.IBinder;
-import android.util.Log;
-
-import androidx.annotation.Nullable;
-
-import com.google.firebase.database.DataSnapshot;
-import com.google.firebase.database.DatabaseError;
-import com.google.firebase.database.DatabaseReference;
-import com.google.firebase.database.FirebaseDatabase;
-import com.google.firebase.database.ValueEventListener;
-
-public class mainService extends Service {
-    private final String TAG="service";
-    // Write a message to the database
-    FirebaseDatabase database = FirebaseDatabase.getInstance();
-    DatabaseReference myRef = database.getReference("Places_Api_Data");
-
-    @Override
-    public int onStartCommand(Intent intent, int flags, int startId) {
-        Log.d(TAG,"Service has started");
-       // myRef.setValue("Hello, World!");
-
-        // Read from the database
-        myRef.addValueEventListener(new ValueEventListener() {
-            @Override
-            public void onDataChange(DataSnapshot dataSnapshot) {
-                if(dataSnapshot.exists())
-                {
-                    for (DataSnapshot child:dataSnapshot.getChildren())
-                    {
-                        place obj=child.getValue(place.class);
-                        obj.setKey(child.getKey());
-                        Log.d(TAG, "Value from service is: " + obj.toString());
-
-                    }
-                }
-            }
-
-            @Override
-            public void onCancelled(DatabaseError error) {
-                // Failed to read value
-                Log.w(TAG, "Failed to read Value from service ", error.toException());
-            }
-        });
-
-        return START_STICKY;
-    }
-
-    @Override
-    public void onDestroy() {
-        super.onDestroy();
-    }
-
-    @Nullable
-    @Override
-    public IBinder onBind(Intent intent) {
-        return null;
-    }
-}
Index: app/src/main/java/com/masterandroid/backgroundservice/MyLocationService.java
===================================================================
--- app/src/main/java/com/masterandroid/backgroundservice/MyLocationService.java	(revision f4b97c3024a5a83433064f2a25999825a4b52b9f)
+++ app/src/main/java/com/masterandroid/backgroundservice/MyLocationService.java	(revision f4b97c3024a5a83433064f2a25999825a4b52b9f)
@@ -1,174 +0,0 @@
-package com.masterandroid.backgroundservice;
-import android.Manifest;
-import android.app.Service;
-import android.content.Context;
-import android.content.Intent;
-import android.content.pm.PackageManager;
-import android.location.Location;
-import android.location.LocationListener;
-import android.location.LocationManager;
-import android.nfc.Tag;
-import android.os.Bundle;
-import android.os.IBinder;
-import android.util.Log;
-import android.widget.Toast;
-import androidx.core.app.ActivityCompat;
-import androidx.core.app.NotificationCompat;
-import androidx.core.app.NotificationManagerCompat;
-
-
-/**
- * Created by roberto on 9/29/16.
- */
-
-public class MyLocationService extends Service {
-    public static final String BROADCAST_ACTION = "Hello World";
-    private static final int TWO_MINUTES = 1000 * 60 * 2;
-    public LocationManager locationManager;
-    public MyLocationListener listener;
-    public Location previousBestLocation = null;
-    String TAG="Location Service";
-    Intent intent;
-    int counter = 0;
-
-    @Override
-    public void onCreate() {
-        super.onCreate();
-        intent = new Intent(BROADCAST_ACTION);
-    }
-    @Override
-    public void onStart(Intent intent, int startId) {
-        locationManager = (LocationManager) getSystemService(Context.LOCATION_SERVICE);
-        listener = new MyLocationListener();
-        if (ActivityCompat.checkSelfPermission(this, Manifest.permission.ACCESS_FINE_LOCATION) != PackageManager.PERMISSION_GRANTED && ActivityCompat.checkSelfPermission(this, Manifest.permission.ACCESS_COARSE_LOCATION) != PackageManager.PERMISSION_GRANTED) {
-            return;
-        }
-        locationManager.requestLocationUpdates(LocationManager.NETWORK_PROVIDER, 4000, 0, (LocationListener) listener);
-        locationManager.requestLocationUpdates(LocationManager.GPS_PROVIDER, 4000, 0, listener);
-    }
-
-    @Override
-    public IBinder onBind(Intent intent) {
-        return null;
-    }
-
-    protected boolean isBetterLocation(Location location, Location currentBestLocation) {
-        if (currentBestLocation == null) {
-            // A new location is always better than no location
-            return true;
-        }
-        // Check whether the new location fix is newer or older
-        long timeDelta = location.getTime() - currentBestLocation.getTime();
-        boolean isSignificantlyNewer = timeDelta > TWO_MINUTES;
-        boolean isSignificantlyOlder = timeDelta < -TWO_MINUTES;
-        boolean isNewer = timeDelta > 0;
-
-        // If it's been more than two minutes since the current location, use the new location
-        // because the user has likely moved
-        if (isSignificantlyNewer) {
-            return true;
-            // If the new location is more than two minutes older, it must be worse
-        } else if (isSignificantlyOlder) {
-            return false;
-        }
-        // Check whether the new location fix is more or less accurate
-        int accuracyDelta = (int) (location.getAccuracy() - currentBestLocation.getAccuracy());
-        boolean isLessAccurate = accuracyDelta > 0;
-        boolean isMoreAccurate = accuracyDelta < 0;
-        boolean isSignificantlyLessAccurate = accuracyDelta > 200;
-
-        // Check if the old and new location are from the same provider
-        boolean isFromSameProvider = isSameProvider(location.getProvider(),
-                currentBestLocation.getProvider());
-
-        // Determine location quality using a combination of timeliness and accuracy
-        if (isMoreAccurate) {
-            return true;
-        } else if (isNewer && !isLessAccurate) {
-            return true;
-        } else if (isNewer && !isSignificantlyLessAccurate && isFromSameProvider) {
-            return true;
-        }
-        return false;
-    }
-    /**
-     * Checks whether two providers are the same
-     */
-    private boolean isSameProvider(String provider1, String provider2) {
-        if (provider1 == null) {
-            return provider2 == null;
-        }
-        return provider1.equals(provider2);
-    }
-    @Override
-    public void onDestroy() {
-       // handler.removeCallbacks(sendUpdatesToUI);
-        super.onDestroy();
-        Log.d("STOP_SERVICE", "DONE");
-        locationManager.removeUpdates(listener);
-    }
-
-    public static Thread performOnBackgroundThread(final Runnable runnable) {
-        final Thread t = new Thread() {
-            @Override
-            public void run() {
-                try {
-                    runnable.run();
-                } finally {
-
-                }
-            }
-        };
-        t.start();
-        return t;
-    }
-
-    public class MyLocationListener implements LocationListener {
-
-        public void onLocationChanged(final Location loc) {
-            Log.i("*****", "Location changed");
-            if (isBetterLocation(loc, previousBestLocation)) {
-                loc.getLatitude();
-                loc.getLongitude();
-                intent.putExtra("Latitude", loc.getLatitude());
-                intent.putExtra("Longitude", loc.getLongitude());
-                intent.putExtra("Provider", loc.getProvider());
-
-                //
-
-               // sendNotification("Location Changed",loc.toString());
-                sendBroadcast(intent);
-                Log.d(TAG,loc.getLatitude()+" "+loc.getLongitude());
-
-            }
-        }
-
-        @Override
-        public void onStatusChanged(String provider, int status, Bundle extras) {
-
-        }
-
-        public void onProviderDisabled(String provider) {
-          //  Toast.makeText(getApplicationContext(), "Gps Disabled", Toast.LENGTH_SHORT).show();
-        }
-
-
-        public void onProviderEnabled(String provider) {
-            Toast.makeText(getApplicationContext(), "Gps Enabled", Toast.LENGTH_SHORT).show();
-        }
-    }
-
-    private void sendNotification(String title,String content){
-        NotificationCompat.Builder builder = new NotificationCompat.Builder(this)
-                .setSmallIcon(R.mipmap.ic_launcher)
-                .setContentTitle(title)
-                .setContentText(content)
-                .setPriority(NotificationCompat.PRIORITY_DEFAULT);
-        NotificationManagerCompat notificationManager = NotificationManagerCompat.from(this);
-
-        // notificationId is a unique int for each notification that you must define
-        notificationManager.notify(1, builder.build());
-    }
-
-
-}
\ No newline at end of file
Index: app/src/main/java/com/masterandroid/backgroundservice/place.java
IDEA additional info:
Subsystem: com.intellij.openapi.diff.impl.patch.BaseRevisionTextPatchEP
<+>package com.masterandroid.backgroundservice;\r\n\r\npublic class place {\r\n    private String key;\r\n    private String place_name;\r\n    private double place_lat;\r\n    private double place_lon;\r\n\r\n    public place(String key, String place_name, double place_lat, double place_lon) {\r\n        this.key = key;\r\n        this.place_name = place_name;\r\n        this.place_lat = place_lat;\r\n        this.place_lon = place_lon;\r\n    }\r\n\r\n    public place() { }\r\n\r\n    public place(String place_name, double place_lat, double place_lon) {\r\n        this.place_name = place_name;\r\n        this.place_lat = place_lat;\r\n        this.place_lon = place_lon;\r\n    }\r\n\r\n    public String getKey() {\r\n        return key;\r\n    }\r\n\r\n    public void setKey(String key) {\r\n        this.key = key;\r\n    }\r\n\r\n    public String getPlace_name() {\r\n        return place_name;\r\n    }\r\n\r\n    public void setPlace_name(String place_name) {\r\n        this.place_name = place_name;\r\n    }\r\n\r\n    public double getPlace_lat() {\r\n        return place_lat;\r\n    }\r\n\r\n    public void setPlace_lat(double place_lat) {\r\n        this.place_lat = place_lat;\r\n    }\r\n\r\n    public double getPlace_lon() {\r\n        return place_lon;\r\n    }\r\n\r\n    public void setPlace_lon(double place_lon) {\r\n        this.place_lon = place_lon;\r\n    }\r\n\r\n    @Override\r\n    public String toString() {\r\n        return \"place{\" +\r\n                \"key='\" + key + '\\'' +\r\n                \", place_name='\" + place_name + '\\'' +\r\n                \", place_lat=\" + place_lat +\r\n                \", place_lon=\" + place_lon +\r\n                '}'+\"\\n\";\r\n    }\r\n}\r\n
Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
<+>UTF-8
===================================================================
--- app/src/main/java/com/masterandroid/backgroundservice/place.java	(revision f4b97c3024a5a83433064f2a25999825a4b52b9f)
+++ app/src/main/java/com/masterandroid/backgroundservice/place.java	(date 1607068257744)
@@ -1,14 +1,15 @@
 package com.masterandroid.backgroundservice;
 
 public class place {
-    private String key;
-    private String place_name;
+    private int place_id;
+    private String city;
+    private String place_address;
     private double place_lat;
     private double place_lon;
 
-    public place(String key, String place_name, double place_lat, double place_lon) {
-        this.key = key;
-        this.place_name = place_name;
+    public place(int place_id, String place_name, double place_lat, double place_lon) {
+        this.place_id = place_id;
+        this.place_address = place_name;
         this.place_lat = place_lat;
         this.place_lon = place_lon;
     }
@@ -16,25 +17,32 @@
     public place() { }
 
     public place(String place_name, double place_lat, double place_lon) {
-        this.place_name = place_name;
+        this.place_address = place_name;
         this.place_lat = place_lat;
         this.place_lon = place_lon;
     }
+    public int getPlace_id() {
+        return place_id;
+    }
 
-    public String getKey() {
-        return key;
+    public void setPlace_id(int place_id) {
+        this.place_id = place_id;
     }
 
-    public void setKey(String key) {
-        this.key = key;
+    public String getCity() {
+        return city;
     }
 
-    public String getPlace_name() {
-        return place_name;
+    public void setCity(String city) {
+        this.city = city;
     }
 
-    public void setPlace_name(String place_name) {
-        this.place_name = place_name;
+    public String getPlace_address() {
+        return place_address;
+    }
+
+    public void setPlace_address(String place_address) {
+        this.place_address = place_address;
     }
 
     public double getPlace_lat() {
@@ -53,13 +61,4 @@
         this.place_lon = place_lon;
     }
 
-    @Override
-    public String toString() {
-        return "place{" +
-                "key='" + key + '\'' +
-                ", place_name='" + place_name + '\'' +
-                ", place_lat=" + place_lat +
-                ", place_lon=" + place_lon +
-                '}'+"\n";
-    }
 }
Index: app/src/main/java/com/masterandroid/backgroundservice/Api.java
IDEA additional info:
Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
<+>UTF-8
===================================================================
--- app/src/main/java/com/masterandroid/backgroundservice/Api.java	(date 1607060472353)
+++ app/src/main/java/com/masterandroid/backgroundservice/Api.java	(date 1607060472353)
@@ -0,0 +1,4 @@
+package com.masterandroid.backgroundservice;
+
+public class Api {
+}
